apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
    meta.helm.sh/release-name: cceaddon-cie-collector
    meta.helm.sh/release-namespace: monitoring
  creationTimestamp: "2025-08-01T08:45:47Z"
  generation: 1
  labels:
    app: cie-collector
    app.kubernetes.io/managed-by: Helm
    chart: cie-collector-3.12.1
    component: kube-state-metrics
    heritage: Helm
    release: cceaddon-cie-collector
  name: kube-state-metrics
  namespace: monitoring
  resourceVersion: "23578"
  uid: 5b2b9aac-45b9-4687-ab0c-1796d7fd8ac6
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: cie-collector
      component: kube-state-metrics
      release: cceaddon-cie-collector
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      annotations:
        seccomp.security.alpha.kubernetes.io/pod: runtime/default
      creationTimestamp: null
      labels:
        app: cie-collector
        chart: cie-collector-3.12.1
        component: kube-state-metrics
        heritage: Helm
        release: cceaddon-cie-collector
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: component
                operator: In
                values:
                - kube-state-metrics
            topologyKey: kubernetes.io/hostname
      containers:
      - command:
        - /bin/sh
        - -c
        - /kube-state-metrics --host=${POD_IP} --port=8080 --leaseDuration=15s --renewDeadline=10s
          --retryPeriod=5s --telemetry-host=127.0.0.1 --telemetry-port=8081 --metric-labels-allowlist=nodes=[node,failure-domain.beta.kubernetes.io/zone,topology.kubernetes.io/zone,cce.cloud.com/cce-nodepool,kubernetes.io/role]
          --resources=daemonsets,deployments,jobs,cronjobs,namespaces,nodes,persistentvolumeclaims,persistentvolumes,pods,resourcequotas,statefulsets,services,replicasets,configmaps,secrets
          --metric-allowlist=kube_cronjob_status_active,kube_cronjob_info,kube_cronjob_labels,kube_configmap_info,kube_daemonset_created,kube_daemonset_status_current_number_scheduled,kube_daemonset_status_desired_number_scheduled,kube_daemonset_status_number_available,kube_daemonset_status_number_misscheduled,kube_daemonset_status_number_ready,kube_daemonset_status_number_unavailable,kube_daemonset_status_updated_number_scheduled,kube_deployment_created,kube_deployment_labels,kube_deployment_metadata_generation,kube_deployment_spec_replicas,kube_deployment_spec_strategy_rollingupdate_max_unavailable,kube_deployment_status_observed_generation,kube_deployment_status_replicas,kube_deployment_status_replicas_available,kube_deployment_status_replicas_ready,kube_deployment_status_replicas_unavailable,kube_deployment_status_replicas_updated,kube_job_info,kube_namespace_labels,kube_node_labels,kube_node_info,kube_node_spec_taint,kube_node_spec_unschedulable,kube_node_status_allocatable,kube_node_status_capacity,kube_node_status_condition,kube_node_volcano_oversubscription_status,kube_persistentvolume_status_phase,kube_persistentvolumeclaim_status_phase,kube_persistentvolume_info,kube_persistentvolumeclaim_info,kube_pod_container_info,kube_pod_container_resource_limits,kube_pod_container_resource_requests,kube_pod_container_status_last_terminated_reason,kube_pod_container_status_ready,kube_pod_container_status_restarts_total,kube_pod_container_status_running,kube_pod_container_status_terminated,kube_pod_container_status_terminated_reason,kube_pod_container_status_waiting,kube_pod_container_status_waiting_reason,kube_pod_info,kube_pod_labels,kube_pod_owner,kube_pod_status_phase,kube_pod_status_ready,kube_pod_spec_volumes_persistentvolumeclaims_info,kube_secret_info,kube_statefulset_created,kube_statefulset_labels,kube_statefulset_metadata_generation,kube_statefulset_replicas,kube_statefulset_status_observed_generation,kube_statefulset_status_replicas,kube_statefulset_status_replicas_ready,kube_statefulset_status_replicas_updated,kube_job_spec_completions,kube_job_status_failed,kube_job_status_succeeded,kube_node_status_allocatable_cpu_cores,kube_node_status_allocatable_memory_bytes,kube_replicaset_owner,kube_resourcequota
        env:
        - name: POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        image: swr.tr-west-1.myhuaweicloud.com/hwofficial/kube-state-metrics:3.12.1
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          httpGet:
            path: /healthz
            port: 8082
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 10
        name: cie-collector-kube-state-metrics
        ports:
        - containerPort: 8080
          name: metrics
          protocol: TCP
        - containerPort: 8081
          name: telemetry
          protocol: TCP
        resources:
          limits:
            cpu: 500m
            memory: 1500Mi
          requests:
            cpu: 200m
            memory: 200Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /etc/localtime
          name: localtime
          readOnly: true
      dnsPolicy: ClusterFirst
      imagePullSecrets:
      - name: default-secret
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: cceaddon-cie-collector-kube-state-metrics
      serviceAccountName: cceaddon-cie-collector-kube-state-metrics
      terminationGracePeriodSeconds: 30
      tolerations:
      - effect: NoSchedule
        key: distribution.io/category
        operator: Equal
        value: IES
      volumes:
      - hostPath:
          path: /etc/localtime
          type: ""
        name: localtime
status:
  availableReplicas: 1
  conditions:
  - lastTransitionTime: "2025-08-01T08:45:47Z"
    lastUpdateTime: "2025-08-01T08:45:47Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  - lastTransitionTime: "2025-08-01T10:27:22Z"
    lastUpdateTime: "2025-08-01T10:27:22Z"
    message: ReplicaSet "kube-state-metrics-99bdcf4c4" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  observedGeneration: 1
  readyReplicas: 1
  replicas: 1
  updatedReplicas: 1
